

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>wx_unittest — Python and wxPython unittests &mdash; Forum Documentation 1.9.3a documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.9.3a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Forum Documentation 1.9.3a documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Forum Documentation 1.9.3a documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><tt class="docutils literal"><span class="pre">wx_unittest</span></tt> &#8212; Python and wxPython unittests</a><ul>
<li><a class="reference internal" href="#elaboration">Elaboration</a><ul>
<li><a class="reference internal" href="#standard-unittesting">Standard Unittesting</a></li>
<li><a class="reference internal" href="#unit-tests-and-gui-controls">Unit tests and GUI controls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation">Implementation</a><ul>
<li><a class="reference internal" href="#unittest-thread">Unittest Thread</a></li>
<li><a class="reference internal" href="#normal-and-priority-queue">Normal and Priority Queue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-write-a-wx-unittest">How to write a wx unittest</a></li>
<li><a class="reference internal" href="#test-coverage">Test coverage</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/unittest.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-wx_unittest">
<span id="wx-unittest-python-and-wxpython-unittests"></span><h1><a class="reference internal" href="#module-wx_unittest" title="wx_unittest: Python and wxPython unittests. (Windows)"><tt class="xref py py-mod docutils literal"><span class="pre">wx_unittest</span></tt></a> &#8212; Python and wxPython unittests<a class="headerlink" href="#module-wx_unittest" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Summary</p>
<table class="last docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Files:</th><td class="field-body"><a class="reference internal" href="unittest_source.html"><em>source</em></a>, <a class="reference internal" href="unittest_example_source.html"><em>example</em></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Target:</th><td class="field-body">developers</td>
</tr>
<tr class="field-odd field"><th class="field-name">Status:</th><td class="field-body">mature</td>
</tr>
</tbody>
</table>
</div>
<hr class="docutils" />
<div class="section" id="elaboration">
<h2>Elaboration<a class="headerlink" href="#elaboration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="standard-unittesting">
<h3>Standard Unittesting<a class="headerlink" href="#standard-unittesting" title="Permalink to this headline">¶</a></h3>
<p>As a described in <a class="reference external" href="http://docs.python.org/2/library/unittest.html">Python Unittest module</a>: <em>unittest supports test automation, sharing of setup and shutdown code for tests, aggregation of tests into collections, and independence of the tests from the reporting framework. The unittest module provides classes that make it easy to support these qualities for a set of tests.</em></p>
<p>To achieve this, unittest supports some important concepts:</p>
<dl class="docutils">
<dt>test fixture</dt>
<dd>A test fixture represents the preparation needed to perform one or more tests, and any associate cleanup actions. This may involve, for example, creating temporary or proxy databases, directories, or starting a server process.</dd>
<dt>test case</dt>
<dd>A test case is the smallest unit of testing. It checks for a specific response to a particular set of inputs. unittest provides a base class, TestCase, which may be used to create new test cases.</dd>
<dt>test suite</dt>
<dd>A test suite is a collection of test cases, test suites, or both. It is used to aggregate tests that should be executed together.</dd>
<dt>test runner</dt>
<dd>A test runner is a component which orchestrates the execution of tests and provides the outcome to the user. The runner may use a graphical interface, a textual interface, or return a special value to indicate the results of executing the tests.</dd>
</dl>
</div>
<div class="section" id="unit-tests-and-gui-controls">
<span id="unittest-gui-control"></span><h3>Unit tests and GUI controls<a class="headerlink" href="#unit-tests-and-gui-controls" title="Permalink to this headline">¶</a></h3>
<p>Testing that the GUI portions of an application behave properly is a bit more tricky because GUIs are based around user events, and so we need to find a way to simulate these. There are a couple different ways to approach testing of GUI applications:</p>
<blockquote>
<div><ul class="simple">
<li>To simulate user interaction (e.g. user clicking a button) and test event handlers, use an automated GUI testing tool</li>
<li>To test that wx or a wx app responds to a particular event handler, simulate the event by firing your own wx event on the window, or just fire the event handler function with a None event</li>
<li>To test your app&#8217;s interaction with a GUI class, write a stub implementation of the GUI class that returns valid (and if applicable non-valid) results</li>
<li>To test setting and retrieving control state and properties, use traditional unit tests</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>With the first two approaches as described in <a class="reference internal" href="#unittest-gui-control"><em>Unit tests and GUI controls</em></a>, over 90% code coverage is achieved. Why not 100%? See <a class="reference internal" href="#unittest-coverage"><em>Test coverage</em></a>. It is important to mention that the unittests implemented here verify the <strong>GUI, API and functional aspects</strong> of the code under test. If you want to skip the implemntation details and use a working example, refer to <a class="reference internal" href="#unittest-how-to"><em>How to write a wx unittest</em></a>.</p>
<p>In the wxPython, as in every major GUI library, all calls to methods of GUI objects and event handlers need to happen on the main thread. Other aspect is that at some point in time the wx.App instance reaches it&#8217;s MainLoop which is exited first, when the application is about to terminate. These two restrictions disallows the straight forward way of implementing the unittest in an extra thread, while the application&#8217;s main thread &#8216;just&#8217; handles the GUI portion of the code.</p>
<p>Therefore the wx.CallAfter function is used as a core of the unittests:</p>
<div class="highlight-python"><pre>print wx.CallAfter.__doc__

Call the specified function after the current and pending event
handlers have been completed.  This is also good for making GUI
method calls from non-GUI threads.  Any extra positional or
keyword args are passed on to the callable when it is called.</pre>
</div>
<p><a class="reference internal" href="unittest_source.html"><em>Source code</em></a> contains the <tt class="xref py py-class docutils literal"><span class="pre">GUITestCase</span></tt> class which should be inherited by specific unit tests for certain module. The key is to specify the test functions inside the <tt class="xref py py-meth docutils literal"><span class="pre">GUITestCase.submit_tests()</span></tt> like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">wx_unittest</span><span class="o">.</span><span class="n">MasterQueue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_some_functionality</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">proceed</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that the method just feeds the internal queue (<tt class="xref py py-class docutils literal"><span class="pre">MasterQueue</span></tt>). The <tt class="xref py py-meth docutils literal"><span class="pre">MasterQueue.proceed()</span></tt> call starts the queue dispatching thread, executing the queue content. Meantime the main thread starts the wx.App.MainLoop() blocking as long as the application lives. Every item in the queue is than posted by the <tt class="docutils literal"><span class="pre">master</span> <span class="pre">queue</span> <span class="pre">thread</span></tt> into the main thread via wx.CallAfter call sequencially. <tt class="docutils literal"><span class="pre">Master</span> <span class="pre">queue</span> <span class="pre">thread</span></tt> starts the <a class="reference internal" href="#unittest-ut-thread"><em>Unittest Thread</em></a> which contains the unittest code as defined in <tt class="xref py py-meth docutils literal"><span class="pre">GUITestCase.submit_tests()</span></tt>. <tt class="docutils literal"><span class="pre">Master</span> <span class="pre">queue</span> <span class="pre">thread</span></tt> responsibilities are:</p>
<blockquote>
<div><ul class="simple">
<li>monitor the internal queues status and start the next test as soon as the current finishes, see <a class="reference internal" href="#unittest-queues"><em>Normal and Priority Queue</em></a></li>
<li>check for unittest completition timeout (wx_unittest.UNITTEST_TIMEOUT) and mark the particular unittest as a failure on timeout expiration</li>
<li>start of the <tt class="xref py py-func docutils literal"><span class="pre">start_exit_watchdog()</span></tt> function, killing the unittest process if the running code can&#8217;t finish within the wx_unittest.APP_EXIT_TIMEOUT seconds</li>
</ul>
</div></blockquote>
<p>After the test queue is emtpy, i.e. all tests have been finished, the unittesting procedure ends.</p>
<div class="figure align-center">
<img alt="_images/classes_wx-unittest.png" src="_images/classes_wx-unittest.png" style="width: 100%;" />
<p class="caption">Class UML diagram</p>
</div>
<div class="section" id="unittest-thread">
<span id="unittest-ut-thread"></span><h3>Unittest Thread<a class="headerlink" href="#unittest-thread" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="normal-and-priority-queue">
<span id="unittest-queues"></span><h3>Normal and Priority Queue<a class="headerlink" href="#normal-and-priority-queue" title="Permalink to this headline">¶</a></h3>
<p>The purpose of having two test queues is following. As in <tt class="docutils literal"><span class="pre">normal</span> <span class="pre">queue</span></tt>, the unittest code is given, see <tt class="xref py py-meth docutils literal"><span class="pre">MasterQueue.proceed()</span></tt>, the <tt class="docutils literal"><span class="pre">priority</span> <span class="pre">queue</span></tt> will be flushed with arbitrary code parts of the code contained in the <tt class="docutils literal"><span class="pre">normal</span> <span class="pre">queue</span></tt>, if the <strong>wx.CallAfter</strong> is present in that code. Let&#8217;s imagine the situation that an event handler call within the <tt class="docutils literal"><span class="pre">normal</span> <span class="pre">queue</span></tt> contains the <em>obj.ShowModal()</em>. This will cause the application to wait for an input which is normally not defined. However, the unittest code containing the <strong>wx.CallAfter</strong> can be used to do certain actions <strong>after</strong>, in this case, the <em>obj.ShowModal()</em> is called. This code portion(s) will be feeded into the <tt class="docutils literal"><span class="pre">prority</span> <span class="pre">queue</span></tt> which is(are) a childern task of a <tt class="docutils literal"><span class="pre">normal</span> <span class="pre">queue</span></tt>. First after the <tt class="docutils literal"><span class="pre">priority</span> <span class="pre">queue</span></tt> is empty, the <tt class="docutils literal"><span class="pre">normal</span> <span class="pre">queue</span></tt> item, i.e. code running with this thread instance, can be marked as complete.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The code under test containing the modal widgets not accepting the keyboard focus, can&#8217;t be tested as this objects can never be interacted from within the unittest. In this case a warning is displayed and unittest ends with a failure.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The user interaction, click events, etc. can change the window focus which is an unexpected interference and the unittest sequence might loose the execution code context, therefore the testing will fail. Use of a non interactive environment, e.g. Jenkins job, is recommended.</p>
</div>
<p>The standard unittest concept is changed for the <tt class="docutils literal"><span class="pre">test</span> <span class="pre">case</span></tt>, where the standard definition say:</p>
<dl class="docutils">
<dt>test case</dt>
<dd><p class="first"><em>A test case is the smallest unit of testing. It checks for a specific response to a particular set of inputs. unittest provides a base class, TestCase, which may be used to create new test cases.</em></p>
<p class="last">The wx unittesting realizes the <strong>test case</strong> as <strong>test case set</strong> containg more then one verification. The reason is the overall architecture using the unittest&#8217;s run method <tt class="xref py py-meth docutils literal"><span class="pre">GUITestCase.runTest()</span></tt> to <tt class="xref py py-meth docutils literal"><span class="pre">GUITestCase.submit_tests()</span></tt>, which instanciates and uses the <tt class="xref py py-class docutils literal"><span class="pre">MasterQueue</span></tt>. Using the original <tt class="docutils literal"><span class="pre">test</span> <span class="pre">case</span></tt> approach executing an atomar unittest would add huge code redundance and decrease readability.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="how-to-write-a-wx-unittest">
<span id="unittest-how-to"></span><h2>How to write a wx unittest<a class="headerlink" href="#how-to-write-a-wx-unittest" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="unittest_example_source.html"><em>Here</em></a> (<tt class="xref download docutils literal"><span class="pre">download</span></tt>) is a an example how a user specific unittest code using the <a class="reference internal" href=""><em>wx unittests</em></a> should look like.</p>
<p>You will get the following output:</p>
<div class="highlight-python"><pre>c:\wx_unittest&gt;test_example.py
runTest (__main__.TestGUI) ... ok
$_test_frame (__main__.TestGUI) ... ok
$_exit_app (__main__.TestGUI) ... ok

----------------------------------------------------------------------
Ran 4 tests in 0.100s

OK</pre>
</div>
</div>
<div class="section" id="test-coverage">
<span id="unittest-coverage"></span><h2>Test coverage<a class="headerlink" href="#test-coverage" title="Permalink to this headline">¶</a></h2>
<p>The unit tests do not completely cover the entire code, because of following reasons:</p>
<blockquote>
<div><ul class="simple">
<li>certain dialogs and widget objects like wx.MessageBox, wx.MessageDialog, wx.FileDialog don&#8217;t take the keyboard focus; therefore if this instance types are shown in a modal mode, therefore blocking unless interacted, there is no way for the unittest to react with such an object - these parts of the code under test should be explicitly skipped</li>
<li>wx.CallAfter and wx.CallLater used in the <em>code under test</em>, might break the unittest as the calls will be hooked and started first <strong>after</strong> the actual testcase, see <a class="reference internal" href="#unittest-queues"><em>Normal and Priority Queue</em></a></li>
<li>it is redundant to test part of the code which belongs to wxPython itself</li>
<li>certain event handlers are bound to multiple events, e.g. button click (Insert button) and key down (wx.WXK_INSERT); if the event handler is verified by triggering the button click event, triggering the key down event is more or less redundant as the functionality has been already prooved</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="index.html">Forum Documentation 1.9.3a documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, noriba GmbH.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>